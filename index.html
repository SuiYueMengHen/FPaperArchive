<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FPaper | 高考联考试卷资源库</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* CSS 变量系统 - 支持动态主题 */
:root {
  /* 动态颜色变量 */
  --primary: #10b981;
  --primary-dark: #0ea271;
  --primary-rgb: 16, 185, 129;
  --primary-dark-rgb: 14, 162, 113;
  
  /* 静态颜色变量 */
  --secondary: #3b82f6;
  --accent: #f59e0b;
  --success: #10b981;
  --warning: #f59e0b;
  --danger: #ef4444;
  --light: #f8fafc;
  --dark: #1e293b;
  
  /* 灰度系统 */
  --gray-100: #f1f5f9;
  --gray-200: #e2e8f0;
  --gray-300: #cbd5e1;
  --gray-400: #94a3b8;
  --gray-500: #64748b;
  --gray-600: #475569;
  --gray-700: #334155;
  --gray-800: #1e293b;
  --gray-900: #0f172a;
  
  /* 渐变 */
  --gradient-primary: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
  --gradient-secondary: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
  --gradient-accent: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
  --gradient-dark: linear-gradient(135deg, #1e293b 0%, #334155 100%);
  
  /* 阴影 */
  --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
  --shadow-md: 0 4px 8px rgba(0,0,0,0.08);
  --shadow-lg: 0 8px 16px rgba(0,0,0,0.1);
  --shadow-xl: 0 12px 24px rgba(0,0,0,0.12);
  --shadow-xxl: 0 20px 40px rgba(0,0,0,0.15);
  
  /* 圆角 */
  --radius-sm: 8px;
  --radius-md: 12px;
  --radius-lg: 16px;
  --radius-xl: 24px;
  --radius-round: 50%;
  
  /* 过渡 */
  --transition-fast: 0.2s ease;
  --transition-normal: 0.3s ease;
  --transition-slow: 0.5s ease;
  
  /* 字体 */
  --font-heading: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  --font-body: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  
  /* 布局变量 */
  --bg-color: #f9fafb;
  --card-bg: #ffffff;
  --text-color: var(--gray-800);
  --header-bg: rgba(255, 255, 255, 0.95);
  --footer-bg: var(--gradient-dark);
  --border-color: var(--gray-200);
}

/* 夜间模式变量 */
[data-theme="dark"] {
  --primary: #e5e7eb;
  --primary-dark: #d1d5db;
  --primary-rgb: 229, 231, 235;
  --primary-dark-rgb: 209, 213, 219;
  
  --light: #111827;
  --dark: #f9fafb;
  
  --gray-100: #1f2937;
  --gray-200: #374151;
  --gray-300: #4b5563;
  --gray-400: #6b7280;
  --gray-500: #9ca3af;
  --gray-600: #d1d5db;
  --gray-700: #e5e7eb;
  --gray-800: #f3f4f6;
  --gray-900: #f9fafb;
  
  --gradient-primary: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
  --gradient-dark: linear-gradient(135deg, #111827 0%, #1f2937 100%);
  
  --shadow-sm: 0 2px 4px rgba(0,0,0,0.5);
  --shadow-md: 0 4px 8px rgba(0,0,0,0.6);
  --shadow-lg: 0 8px 16px rgba(0,0,0,0.7);
  --shadow-xl: 0 12px 24px rgba(0,0,0,0.75);
  --shadow-xxl: 0 20px 40px rgba(0,0,0,0.8);
  
  --bg-color: #111827;
  --card-bg: #1f2937;
  --text-color: #f9fafb;
  --header-bg: rgba(31, 41, 55, 0.95);
  --border-color: #374151;
}

/* 基础重置 - 移除所有下划线和列表符号 */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html {
  scroll-behavior: smooth;
  overflow-x: hidden;
}

body {
  font-family: var(--font-body);
  font-size: 16px;
  line-height: 1.6;
  color: var(--text-color);
  background-color: var(--bg-color);
  transition: background-color var(--transition-normal), color var(--transition-normal);
  overflow-x: hidden;
  position: relative;
}

/* 移除所有链接的下划线 */
a {
  text-decoration: none;
  color: inherit;
}

/* 移除所有列表的符号 */
ul, ol {
  list-style: none;
}

/* 颜色切换动效 */
.color-transition {
  position: fixed;
  top: 0;
  left: 0;
  width: 0;
  height: 0;
  border-radius: 50%;
  background: var(--gradient-primary);
  transform: translate(-50%, -50%);
  z-index: 10000;
  pointer-events: none;
  opacity: 0.8;
}

.color-transition.active {
  animation: colorExpand 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

@keyframes colorExpand {
  0% {
    width: 0;
    height: 0;
    opacity: 0.8;
  }
  100% {
    width: 300vw;
    height: 300vw;
    opacity: 0;
  }
}

/* 导航栏 */
.navbar {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  background: var(--header-bg);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  box-shadow: var(--shadow-md);
  z-index: 1000;
  padding: 15px 0;
  transition: all var(--transition-normal);
  will-change: transform, background, box-shadow;
}

.navbar.scrolled {
  padding: 10px 0;
  box-shadow: var(--shadow-lg);
}

.navbar-container {
  max-width: 1280px;
  margin: 0 auto;
  padding: 0 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.navbar-brand {
  display: flex;
  align-items: center;
  gap: 12px;
}

.logo {
  width: 40px;
  height: 40px;
  background: var(--gradient-primary);
  border-radius: var(--radius-md);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: 700;
  font-size: 20px;
  box-shadow: var(--shadow-md);
  transition: all var(--transition-fast);
  will-change: background, transform;
}

.logo-text {
  font-size: 24px;
  font-weight: 800;
  background: var(--gradient-primary);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  transition: all var(--transition-fast);
  will-change: background;
}

.nav-links {
  display: flex;
  gap: 30px;
  align-items: center;
  position: relative;
}

.nav-link {
  font-weight: 600;
  color: var(--gray-700);
  padding: 8px 16px;
  border-radius: var(--radius-md);
  transition: all var(--transition-fast);
  position: relative;
  cursor: pointer;
  overflow: hidden;
  will-change: color, background, transform;
}

.nav-link:hover {
  color: var(--primary);
  background-color: rgba(var(--primary-rgb), 0.1);
}

.nav-link.active {
  color: white;
  background: var(--gradient-primary);
  box-shadow: var(--shadow-md);
}

.nav-link.active::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 3px;
  background-color: white;
  border-radius: 3px;
}

/* 导航动效 */
.nav-link.slide-left::after {
  animation: slideLeft 0.3s ease-out;
}

.nav-link.slide-right::after {
  animation: slideRight 0.3s ease-out;
}

@keyframes slideLeft {
  from { transform: translateX(100%); }
  to { transform: translateX(0); }
}

@keyframes slideRight {
  from { transform: translateX(-100%); }
  to { transform: translateX(0); }
}

/* 主题控制 */
.theme-controls {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-left: 20px;
}

.theme-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  border-radius: var(--radius-round);
  background: var(--gray-100);
  border: 1px solid var(--border-color);
  color: var(--gray-700);
  cursor: pointer;
  transition: all var(--transition-fast);
  will-change: transform, background;
}

.theme-btn:hover {
  background: var(--gray-200);
  transform: translateY(-2px);
}

.color-picker-menu {
  position: absolute;
  top: 50px;
  right: 0;
  background: var(--card-bg);
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-lg);
  padding: 20px;
  z-index: 1001;
  width: 300px;
  display: none;
  animation: fadeIn 0.3s ease;
  will-change: transform, opacity;
}

.color-picker-menu.show {
  display: block;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}

.color-picker-tabs {
  display: flex;
  margin-bottom: 15px;
  border-bottom: 1px solid var(--border-color);
}

.color-tab {
  flex: 1;
  padding: 10px;
  text-align: center;
  cursor: pointer;
  border-bottom: 2px solid transparent;
  transition: all var(--transition-fast);
}

.color-tab.active {
  border-bottom-color: var(--primary);
  color: var(--primary);
  font-weight: 600;
}

.color-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 10px;
  margin-bottom: 15px;
}

.color-option {
  width: 30px;
  height: 30px;
  border-radius: var(--radius-round);
  cursor: pointer;
  border: 2px solid transparent;
  transition: all var(--transition-fast);
  will-change: transform;
}

.color-option:hover {
  transform: scale(1.1);
}

.color-option.active {
  border-color: var(--primary);
  box-shadow: 0 0 0 2px rgba(var(--primary-rgb), 0.3);
}

.color-preview {
  width: 100%;
  height: 60px;
  border-radius: var(--radius-md);
  margin-bottom: 15px;
  background: var(--gradient-primary);
  transition: all var(--transition-fast);
  will-change: background;
}

/* 重新设计RGB选择器布局 */
.rgb-controls {
  margin-bottom: 15px;
}

.rgb-input-group {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.rgb-input {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.rgb-input-row {
  display: flex;
  align-items: center;
  gap: 10px;
}

.rgb-input label {
  font-size: 12px;
  color: var(--gray-600);
  min-width: 30px;
}

.rgb-slider-container {
  flex: 1;
  display: flex;
  align-items: center;
  gap: 10px;
}

.rgb-input input[type="range"] {
  flex: 1;
  height: 6px;
  -webkit-appearance: none;
  background: var(--gray-200);
  border-radius: 3px;
  outline: none;
}

.rgb-input input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: var(--primary);
  cursor: pointer;
  border: 2px solid white;
  box-shadow: var(--shadow-sm);
}

.rgb-input input[type="range"]::-moz-range-thumb {
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: var(--primary);
  cursor: pointer;
  border: 2px solid white;
  box-shadow: var(--shadow-sm);
}

.rgb-value {
  min-width: 40px;
  text-align: right;
  font-size: 14px;
  color: var(--gray-700);
  font-weight: 600;
}

.color-actions {
  display: flex;
  gap: 10px;
}

.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 12px 24px;
  font-weight: 600;
  border-radius: var(--radius-md);
  border: none;
  cursor: pointer;
  transition: all var(--transition-fast);
  gap: 8px;
  white-space: nowrap;
  will-change: transform, box-shadow;
}

.btn:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.btn-primary {
  background: var(--gradient-primary);
  color: white;
  box-shadow: var(--shadow-md);
}

.btn-outline {
  background: transparent;
  color: var(--primary);
  border: 2px solid var(--primary);
}

.btn-outline:hover {
  background: var(--primary);
  color: white;
}

.btn-sm {
  padding: 8px 16px;
  font-size: 14px;
}

/* 主内容区域 */
.main-content {
  margin-top: 80px;
  padding: 40px 0;
  min-height: calc(100vh - 200px);
  will-change: opacity, transform;
}

.container {
  max-width: 1280px;
  margin: 0 auto;
  padding: 0 20px;
}

/* 页面切换 */
.page {
  display: none;
  opacity: 0;
  transform: translateY(10px);
  transition: opacity 0.3s ease, transform 0.3s ease;
  will-change: opacity, transform;
}

.page.active {
  display: block;
  opacity: 1;
  transform: translateY(0);
  animation: pageIn 0.4s ease-out;
}

@keyframes pageIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

/* 英雄区域 - 修复显示问题 */
.hero {
  padding: 80px 0;
  background: linear-gradient(135deg, 
    rgba(var(--primary-rgb), 0.05) 0%, 
    rgba(var(--primary-dark-rgb), 0.05) 30%, 
    rgba(var(--primary-rgb), 0.02) 70%, 
    rgba(var(--primary-dark-rgb), 0.02) 100%
  );
  border-radius: var(--radius-xl);
  margin-bottom: 60px;
  text-align: center;
  position: relative;
  overflow: hidden;
  transition: all var(--transition-fast);
  will-change: background;
}

/* 移除有问题的SVG背景，改用纯CSS渐变 */
.hero::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: 
    radial-gradient(circle at 20% 80%, rgba(var(--primary-rgb), 0.03) 0%, transparent 50%),
    radial-gradient(circle at 80% 20%, rgba(var(--primary-dark-rgb), 0.03) 0%, transparent 50%);
  pointer-events: none;
}

.hero-title {
  font-size: 48px;
  margin-bottom: 20px;
  background: var(--gradient-primary);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  transition: all var(--transition-fast);
  will-change: background;
  position: relative;
  z-index: 1;
}

.hero-subtitle {
  font-size: 20px;
  color: var(--gray-600);
  max-width: 700px;
  margin: 0 auto 40px;
  line-height: 1.6;
  position: relative;
  z-index: 1;
}

/* 统计卡片 */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 24px;
  margin-bottom: 60px;
}

.stat-card {
  background: var(--card-bg);
  border-radius: var(--radius-lg);
  padding: 30px;
  box-shadow: var(--shadow-md);
  transition: all var(--transition-normal);
  position: relative;
  overflow: hidden;
  will-change: transform, box-shadow;
}

.stat-card:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-xl);
}

.stat-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 6px;
  height: 100%;
  background: var(--gradient-primary);
  transition: all var(--transition-fast);
  will-change: background;
}

.stat-icon {
  width: 60px;
  height: 60px;
  background: var(--gradient-primary);
  border-radius: var(--radius-md);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 24px;
  margin-bottom: 20px;
  transition: all var(--transition-fast);
  will-change: background;
}

.stat-value {
  font-size: 36px;
  font-weight: 800;
  color: var(--gray-900);
  margin-bottom: 8px;
}

.stat-label {
  font-size: 16px;
  color: var(--gray-600);
  font-weight: 500;
}

/* 表格样式 */
.table-container {
  background: var(--card-bg);
  border-radius: var(--radius-lg);
  overflow: hidden;
  box-shadow: var(--shadow-md);
  margin-bottom: 40px;
  will-change: transform;
}

.table-header {
  padding: 24px;
  border-bottom: 1px solid var(--border-color);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.table-title {
  font-size: 20px;
  font-weight: 700;
  color: var(--gray-900);
}

.papers-table {
  width: 100%;
  border-collapse: collapse;
}

.papers-table th {
  padding: 16px 24px;
  text-align: left;
  background: var(--gray-100);
  color: var(--gray-700);
  font-weight: 600;
  font-size: 14px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  border-bottom: 1px solid var(--border-color);
}

.papers-table td {
  padding: 20px 24px;
  border-bottom: 1px solid var(--border-color);
  vertical-align: middle;
}

.papers-table tr:last-child td {
  border-bottom: none;
}

.papers-table tr:hover {
  background-color: rgba(var(--primary-rgb), 0.03);
}

/* 联考试卷展开样式 - 优化动画逻辑 */
.exam-row {
  cursor: pointer;
  transition: all var(--transition-fast);
}

.exam-row:hover {
  background-color: rgba(var(--primary-rgb), 0.05) !important;
}

/* 已展开的联考详情 - 不需要动画 */
.exam-details {
  background: var(--gray-100);
  overflow: hidden;
}

/* 新展开的联考详情 - 添加动画 */
.exam-details.expanding {
  animation: examExpand 0.4s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

@keyframes examExpand {
  from {
    max-height: 0;
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    max-height: 1000px;
    opacity: 1;
    transform: translateY(0);
  }
}

.exam-details-content {
  padding: 20px;
}

/* 新展开的内容 - 添加动画 */
.exam-details-content.animating {
  animation: contentFadeIn 0.3s ease 0.1s both;
}

@keyframes contentFadeIn {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.exam-subject {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 16px;
  margin-bottom: 8px;
  background: var(--card-bg);
  border-radius: var(--radius-md);
  border: 1px solid var(--border-color);
  transition: all var(--transition-fast);
}

/* 新展开的试卷项目 - 添加动画 */
.exam-subject.animating {
  animation: subjectSlideIn 0.3s ease both;
}

@keyframes subjectSlideIn {
  from {
    opacity: 0;
    transform: translateX(-20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

.exam-subject:hover {
  transform: translateX(5px);
  box-shadow: var(--shadow-sm);
}

.exam-subject-name {
  font-weight: 600;
}

.exam-subject-date {
  color: var(--gray-600);
  font-size: 14px;
}

/* 搜索区域 */
.search-section {
  background: var(--card-bg);
  border-radius: var(--radius-lg);
  padding: 30px;
  box-shadow: var(--shadow-md);
  margin-bottom: 40px;
}

.search-title {
  font-size: 24px;
  margin-bottom: 24px;
  color: var(--gray-900);
}

.search-form {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.form-label {
  font-weight: 600;
  color: var(--gray-700);
  font-size: 14px;
}

.form-control {
  padding: 12px 16px;
  border: 1px solid var(--border-color);
  border-radius: var(--radius-md);
  font-size: 16px;
  transition: all var(--transition-fast);
  background-color: var(--card-bg);
  color: var(--text-color);
  will-change: border-color, box-shadow;
}

.form-control:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 2px rgba(var(--primary-rgb), 0.1);
}

/* 数据源指示器 */
.data-source-info {
  background: rgba(var(--primary-rgb), 0.05);
  border: 1px solid rgba(var(--primary-rgb), 0.2);
  border-radius: var(--radius-md);
  padding: 12px 16px;
  margin-top: 20px;
  font-size: 14px;
  color: var(--gray-600);
  transition: all var(--transition-fast);
  will-change: background, border-color;
}

.data-source-info i {
  color: var(--primary);
  margin-right: 8px;
}

/* 图片展示框 */
.image-showcase {
  margin: 40px 0;
  text-align: center;
}

.image-box {
  background: var(--card-bg);
  border-radius: var(--radius-lg);
  padding: 30px;
  box-shadow: var(--shadow-md);
  transition: all var(--transition-fast);
  will-change: transform, box-shadow;
}

.image-box:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-xl);
}

.image-box img {
  max-width: 100%;
  height: auto;
  border-radius: var(--radius-md);
  box-shadow: var(--shadow-lg);
}

.image-box-title {
  font-size: 20px;
  margin-bottom: 20px;
  color: var(--gray-900);
}

/* 提示框 - 优化样式 */
.toast-container {
  position: fixed;
  top: 100px;
  right: 20px;
  z-index: 9999;
  display: flex;
  flex-direction: column;
  gap: 10px;
  max-width: 350px;
  pointer-events: none;
}

.toast {
  position: relative;
  background: var(--card-bg);
  border-radius: var(--radius-md);
  padding: 16px 20px;
  box-shadow: var(--shadow-lg);
  animation: slideInFromRight 0.3s ease-out forwards;
  pointer-events: auto;
  margin-bottom: 10px;
  transition: all var(--transition-fast);
  will-change: transform, opacity;
  border-left: 4px solid var(--primary); /* 动态颜色 */
}

.toast.fade-out {
  animation: slideOutToRight 0.3s ease-in forwards;
}

@keyframes slideInFromRight {
  from { opacity: 0; transform: translateX(100%); }
  to { opacity: 1; transform: translateX(0); }
}

@keyframes slideOutToRight {
  from { opacity: 1; transform: translateX(0); }
  to { opacity: 0; transform: translateX(100%); }
}

/* 不同类型的提示框 */
.toast-success {
  border-left-color: var(--success);
}

.toast-error {
  border-left-color: var(--danger);
}

.toast-info {
  border-left-color: var(--primary);
}

.toast-warning {
  border-left-color: var(--warning);
}

.toast-content {
  display: flex;
  align-items: center;
  gap: 12px;
}

/* 优化关闭按钮样式 */
.toast-close {
  background: transparent;
  border: none;
  color: var(--gray-500);
  cursor: pointer;
  font-size: 16px;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: var(--radius-round);
  transition: all var(--transition-fast);
  margin-left: 8px;
  padding: 0;
  flex-shrink: 0;
}

.toast-close:hover {
  background: var(--gray-100);
  color: var(--danger);
  transform: scale(1.1);
}

.toast-icon {
  font-size: 18px;
  flex-shrink: 0;
}

.toast-message {
  flex-grow: 1;
  font-size: 14px;
  line-height: 1.4;
}

/* 模态框 */
.modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(5px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 2000;
  opacity: 0;
  visibility: hidden;
  transition: all var(--transition-normal);
  will-change: opacity;
}

.modal.show {
  opacity: 1;
  visibility: visible;
}

.modal-content {
  background: var(--card-bg);
  border-radius: var(--radius-lg);
  width: 90%;
  max-width: 500px;
  max-height: 90vh;
  overflow-y: auto;
  transform: translateY(20px);
  transition: transform var(--transition-normal);
  will-change: transform;
}

.modal.show .modal-content {
  transform: translateY(0);
}

.modal-header {
  padding: 24px;
  border-bottom: 1px solid var(--border-color);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.modal-title {
  font-size: 24px;
  font-weight: 700;
  color: var(--gray-900);
}

.modal-close {
  background: none;
  border: none;
  font-size: 24px;
  color: var(--gray-500);
  cursor: pointer;
  transition: color var(--transition-fast);
}

.modal-close:hover {
  color: var(--danger);
}

.modal-body {
  padding: 24px;
}

.modal-footer {
  padding: 20px 24px;
  border-top: 1px solid var(--border-color);
  display: flex;
  justify-content: flex-end;
  gap: 12px;
}

/* 页脚 - 移除列表符号和下划线 */
.footer {
  background: var(--footer-bg);
  color: white;
  padding: 60px 0 30px;
  margin-top: 80px;
}

.footer-content {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 40px;
  margin-bottom: 40px;
}

.footer-section-title {
  font-size: 18px;
  font-weight: 700;
  margin-bottom: 20px;
  color: white;
}

.footer-links {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.footer-link {
  color: var(--gray-300);
  transition: color var(--transition-fast);
  cursor: pointer;
  display: inline-block;
  text-decoration: none;
}

.footer-link:hover {
  color: white;
  text-decoration: none;
}

.footer-bottom {
  text-align: center;
  padding-top: 30px;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  color: var(--gray-400);
  font-size: 14px;
}

/* 空状态 */
.empty-state {
  text-align: center;
  padding: 60px 20px;
}

.empty-state-icon {
  font-size: 64px;
  color: var(--gray-300);
  margin-bottom: 20px;
}

.empty-state-title {
  font-size: 24px;
  color: var(--gray-700);
  margin-bottom: 12px;
}

.empty-state-description {
  color: var(--gray-600);
  max-width: 400px;
  margin: 0 auto 30px;
}

/* 加载状态 */
.loading {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 40px;
}

.loading-spinner {
  width: 40px;
  height: 40px;
  border: 3px solid var(--gray-200);
  border-top-color: var(--primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-bottom: 16px;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.loading-text {
  color: var(--gray-600);
  font-size: 16px;
}

/* 工具类 */
.d-none { display: none !important; }
.d-flex { display: flex !important; }
.justify-between { justify-content: space-between; }
.align-center { align-items: center; }
.text-center { text-align: center; }
.mb-20 { margin-bottom: 20px; }
.mb-40 { margin-bottom: 40px; }
.mt-20 { margin-top: 20px; }
.mt-40 { margin-top: 40px; }
.w-100 { width: 100%; }
.gap-10 { gap: 10px; }
.gap-15 { gap: 15px; }
.gap-20 { gap: 20px; }
.justify-center { justify-content: center; }

/* 响应式设计 */
@media (max-width: 768px) {
  .navbar-container {
    flex-direction: column;
    gap: 15px;
  }
  
  .nav-links {
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
  }
  
  .theme-controls {
    margin-left: 0;
    margin-top: 10px;
  }
  
  .color-picker-menu {
    width: 280px;
    right: -50px;
  }
  
  .hero-title {
    font-size: 36px;
  }
  
  .hero-subtitle {
    font-size: 18px;
  }
  
  .table-header {
    flex-direction: column;
    gap: 20px;
    align-items: flex-start;
  }
  
  .search-form {
    grid-template-columns: 1fr;
  }
  
  .action-buttons {
    flex-direction: column;
    width: 100%;
  }
  
  .action-buttons .btn {
    width: 100%;
    margin-bottom: 5px;
  }
  
  .exam-subject {
    flex-direction: column;
    gap: 10px;
    align-items: flex-start;
  }
  
  .exam-subject .action-buttons {
    width: 100%;
    justify-content: flex-end;
  }
  
  .toast-container {
    max-width: calc(100% - 40px);
    right: 10px;
    left: 10px;
  }
}
</style>
</head>
<body>
<!-- 颜色切换动效 -->
<div class="color-transition"></div>

<!-- 提示框容器 -->
<div class="toast-container"></div>

<!-- 顶部导航栏 -->
<nav class="navbar">
  <div class="navbar-container">
    <div class="navbar-brand">
      <div class="logo">F</div>
      <div class="logo-text">FPaper 试卷库</div>
    </div>
    <div class="d-flex align-center">
      <ul class="nav-links">
        <li><a href="#" class="nav-link active" data-page="home">首页</a></li>
        <li><a href="#" class="nav-link" data-page="papers">试卷库</a></li>
        <li><a href="#" class="nav-link" data-page="about">关于</a></li>
      </ul>
      <div class="theme-controls">
        <button class="theme-btn color-picker-btn" id="color-picker-btn" title="自定义颜色">
          <i class="fas fa-palette"></i>
        </button>
        <div class="color-picker-menu" id="color-picker-menu">
          <div class="color-picker-tabs">
            <div class="color-tab active" data-tab="preset">预设颜色</div>
            <div class="color-tab" data-tab="custom">自定义颜色</div>
          </div>
          <div class="color-tab-content" id="preset-colors">
            <div class="color-grid">
              <div class="color-option active" data-color="green" style="background: linear-gradient(135deg, #10b981 0%, #0d9668 100%);"></div>
              <div class="color-option" data-color="blue" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);"></div>
              <div class="color-option" data-color="purple" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);"></div>
              <div class="color-option" data-color="red" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);"></div>
              <div class="color-option" data-color="orange" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);"></div>
              <div class="color-option" data-color="teal" style="background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%);"></div>
              <div class="color-option" data-color="pink" style="background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);"></div>
              <div class="color-option" data-color="indigo" style="background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);"></div>
              <div class="color-option" data-color="cyan" style="background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);"></div>
              <div class="color-option" data-color="lime" style="background: linear-gradient(135deg, #84cc16 0%, #65a30d 100%);"></div>
              <div class="color-option" data-color="amber" style="background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);"></div>
              <div class="color-option" data-color="rose" style="background: linear-gradient(135deg, #f43f5e 0%, #e11d48 100%);"></div>
              <div class="color-option" data-color="violet" style="background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%);"></div>
              <div class="color-option" data-color="emerald" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);"></div>
              <div class="color-option" data-color="sky" style="background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);"></div>
              <div class="color-option" data-color="fuchsia" style="background: linear-gradient(135deg, #d946ef 0%, #c026d3 100%);"></div>
              <div class="color-option" data-color="yellow" style="background: linear-gradient(135deg, #eab308 0%, #ca8a04 100%);"></div>
              <div class="color-option" data-color="stone" style="background: linear-gradient(135deg, #78716c 0%, #57534e 100%);"></div>
              <div class="color-option" data-color="neutral" style="background: linear-gradient(135deg, #737373 0%, #525252 100%);"></div>
              <div class="color-option" data-color="zinc" style="background: linear-gradient(135deg, #71717a 0%, #52525b 100%);"></div>
            </div>
          </div>
          <div class="color-tab-content d-none" id="custom-colors">
            <div class="color-preview" id="color-preview"></div>
            <div class="rgb-controls">
              <div class="rgb-input-group">
                <div class="rgb-input">
                  <label>红色 (R)</label>
                  <div class="rgb-input-row">
                    <span style="min-width: 30px;">0</span>
                    <div class="rgb-slider-container">
                      <input type="range" id="rgb-r" min="0" max="255" value="16">
                      <span class="rgb-value" id="rgb-r-value">16</span>
                    </div>
                    <span style="min-width: 30px;">255</span>
                  </div>
                </div>
                <div class="rgb-input">
                  <label>绿色 (G)</label>
                  <div class="rgb-input-row">
                    <span style="min-width: 30px;">0</span>
                    <div class="rgb-slider-container">
                      <input type="range" id="rgb-g" min="0" max="255" value="185">
                      <span class="rgb-value" id="rgb-g-value">185</span>
                    </div>
                    <span style="min-width: 30px;">255</span>
                  </div>
                </div>
                <div class="rgb-input">
                  <label>蓝色 (B)</label>
                  <div class="rgb-input-row">
                    <span style="min-width: 30px;">0</span>
                    <div class="rgb-slider-container">
                      <input type="range" id="rgb-b" min="0" max="255" value="129">
                      <span class="rgb-value" id="rgb-b-value">129</span>
                    </div>
                    <span style="min-width: 30px;">255</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="color-actions">
            <button class="btn btn-outline w-100" id="reset-color-btn">
              <i class="fas fa-redo"></i>
              重置
            </button>
            <button class="btn btn-primary w-100" id="apply-color-btn">
              <i class="fas fa-check"></i>
              应用
            </button>
          </div>
        </div>
        <button class="theme-btn" id="theme-toggle-btn" title="切换日间/夜间模式">
          <i class="fas fa-moon"></i>
        </button>
      </div>
    </div>
  </div>
</nav>

<!-- 主内容区域 -->
<main class="main-content">
  <div class="container">
    <!-- 首页 -->
    <div id="home-page" class="page active">
      <div class="hero">
        <h1 class="hero-title">高考联考试卷资源库</h1>
        <p class="hero-subtitle">收集全国各地高考联考真题和模拟题，提供高质量的学习资源，助力高考备考和教学研究</p>
        <div class="d-flex justify-center align-center gap-20">
          <button class="btn btn-primary" data-page="papers">
            <i class="fas fa-book-open"></i>
            浏览试卷
          </button>
        </div>
      </div>
      
      <div id="stats-container">
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-file-alt"></i>
            </div>
            <div class="stat-value" id="total-papers">0</div>
            <div class="stat-label">总试卷数量</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-calendar-alt"></i>
            </div>
            <div class="stat-value" id="total-years">0</div>
            <div class="stat-label">年份跨度</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-tags"></i>
            </div>
            <div class="stat-value" id="total-categories">0</div>
            <div class="stat-label">科目数量</div>
          </div>
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-calendar-alt"></i>
            </div>
            <div class="stat-value" id="latest-year">2025</div>
            <div class="stat-label">最新年份</div>
          </div>
        </div>
      </div>
      
      <div class="table-container">
        <div class="table-header">
          <h2 class="table-title">最新联考</h2>
          <a href="#" class="btn btn-outline btn-sm" data-page="papers">
            查看全部
            <i class="fas fa-arrow-right"></i>
          </a>
        </div>
        <div id="recent-papers-table">
          <div class="loading">
            <div class="loading-spinner"></div>
            <div class="loading-text">正在加载联考数据...</div>
          </div>
        </div>
      </div>
    </div>

    <!-- 试卷库页面 -->
    <div id="papers-page" class="page">
      <div class="search-section">
        <h2 class="search-title">试卷库</h2>
        <div class="search-form">
          <div class="form-group">
            <label class="form-label">搜索关键词</label>
            <input type="text" class="form-control" id="paper-search" placeholder="联考名称、科目或关键词">
          </div>
          <div class="form-group">
            <label class="form-label">科目分类</label>
            <select class="form-control" id="paper-category">
              <option value="">所有科目</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">年份</label>
            <select class="form-control" id="paper-year">
              <option value="">所有年份</option>
            </select>
          </div>
        </div>
        <div class="d-flex justify-between align-center">
          <button class="btn btn-primary" id="search-papers-btn">
            <i class="fas fa-search"></i>
            搜索
          </button>
          <button class="btn btn-outline" id="reset-search-btn">
            <i class="fas fa-redo"></i>
            重置
          </button>
        </div>
        <div id="data-source-info" class="data-source-info d-none">
          <i class="fas fa-database"></i>
          <span>数据源：data.txt + category.txt文件 | 共加载了<span id="loaded-exams-count">0</span>个联考，<span id="loaded-papers-count">0</span>份试卷</span>
        </div>
      </div>
      
      <div class="table-container">
        <table class="papers-table" id="papers-table">
          <thead>
            <tr>
              <th>联考名称</th>
              <th>包含科目</th>
              <th>最新日期</th>
              <th>操作</th>
            </tr>
          </thead>
          <tbody id="papers-table-body">
            <tr>
              <td colspan="4" style="text-align: center; padding: 40px;">
                <div class="loading">
                  <div class="loading-spinner"></div>
                  <div class="loading-text">正在加载联考数据...</div>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- 关于页面 -->
    <div id="about-page" class="page">
      <div class="hero">
        <h1 class="hero-title">关于 FPaper 试卷库</h1>
        <p class="hero-subtitle">一个致力于高考教育资源整合的开源项目</p>
      </div>
      
      <div class="search-section mb-40">
        <h2 class="search-title">项目简介</h2>
        <p style="color: var(--gray-600); line-height: 1.8; margin-bottom: 20px;">
          FPaper 试卷库是一个专注于收集、整理和管理中国历年高考联考真题及各地市模拟题的开源平台。我们的使命是为高考学生、教师和研究人员提供高质量、系统化的备考资源，助力高考备考和教学研究的进步。
        </p>
        <p style="color: var(--gray-600); line-height: 1.8;">
          平台采用现代化的Web技术构建，具有响应式设计、直观的用户界面和强大的搜索功能。所有数据来源于公开资源，持续更新维护。
        </p>
      </div>
      
      <div class="image-showcase">
        <div class="image-box">
          <h3 class="image-box-title">平台截图</h3>
          <div id="platform-image-container">
            <img id="platform-image" src="" alt="FPaper 平台截图" style="max-width: 100%; height: auto; border-radius: var(--radius-md);">
            <div id="image-error" class="d-none" style="padding: 40px; color: var(--gray-500); text-align: center;">
              <i class="fas fa-image" style="font-size: 48px; margin-bottom: 20px;"></i>
              <p>图片加载失败</p>
            </div>
          </div>
        </div>
      </div>
      
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-code-branch"></i>
          </div>
          <div class="stat-value">开源</div>
          <div class="stat-label">完全开源项目</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-users"></i>
          </div>
          <div class="stat-value">社区驱动</div>
          <div class="stat-label">由社区共同维护</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-graduation-cap"></i>
          </div>
          <div class="stat-value">教育公益</div>
          <div class="stat-label">专注于教育公益</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">
            <i class="fas fa-sync-alt"></i>
          </div>
          <div class="stat-value">持续更新</div>
          <div class="stat-label">定期更新和维护</div>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- 页脚 -->
<footer class="footer">
  <div class="container">
    <div class="footer-content">
      <div>
        <h3 class="footer-section-title">FPaper 试卷库</h3>
        <p style="color: var(--gray-300); margin-bottom: 20px;">
          高考联考真题与模拟题资源库，为高考备考提供高质量的学习资源。
        </p>
        <div class="d-flex gap-15">
          <a href="#" class="footer-link">
            <i class="fab fa-github"></i>
          </a>
          <a href="#" class="footer-link">
            <i class="fab fa-weixin"></i>
          </a>
          <a href="#" class="footer-link">
            <i class="fab fa-qq"></i>
          </a>
        </div>
      </div>
      <div>
        <h3 class="footer-section-title">快速链接</h3>
        <ul class="footer-links">
          <li><a href="#" class="footer-link" data-page="home">首页</a></li>
          <li><a href="#" class="footer-link" data-page="papers">试卷库</a></li>
          <li><a href="#" class="footer-link" data-page="about">关于</a></li>
        </ul>
      </div>
      <div>
        <h3 class="footer-section-title">科目分类</h3>
        <ul class="footer-links" id="footer-categories">
          <!-- 动态加载 -->
        </ul>
      </div>
      <div>
        <h3 class="footer-section-title">联系我们</h3>
        <ul class="footer-links">
          <li><a href="mailto:contact@fpaper.org" class="footer-link">contact@fpaper.org</a></li>
          <li><a href="#" class="footer-link">贡献指南</a></li>
          <li><a href="#" class="footer-link">使用说明</a></li>
          <li><a href="#" class="footer-link">更新日志</a></li>
        </ul>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2024 FPaper 试卷库. 保留所有权利。 | 一个开源高考教育项目</p>
    </div>
  </div>
</footer>

<!-- 下载确认模态框 -->
<div id="download-modal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 class="modal-title">确认下载</h3>
      <button class="modal-close" id="close-download-modal">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <p>您即将下载试卷：<strong id="download-paper-name"></strong></p>
      <div class="alert" style="background: rgba(var(--primary-rgb), 0.1); color: var(--primary); padding: 12px; border-radius: var(--radius-md); margin: 20px 0; border-left: 4px solid var(--primary);">
        <i class="fas fa-info-circle"></i>
        <span>请注意：部分试卷链接可能指向外部网站，请确保您信任该来源。</span>
      </div>
      <div style="font-size: 14px; color: var(--gray-600);">
        <p>下载链接：</p>
        <code id="download-paper-url" style="display: block; padding: 10px; background: var(--gray-100); border-radius: var(--radius-md); margin-top: 5px; word-break: break-all;"></code>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" id="cancel-download">取消</button>
      <a href="#" target="_blank" class="btn btn-primary" id="confirm-download-link">确认下载</a>
    </div>
  </div>
</div>

<!-- 试卷详情模态框 -->
<div id="paper-details-modal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 class="modal-title" id="paper-details-title">试卷详情</h3>
      <button class="modal-close" id="close-paper-details">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body" id="paper-details-content">
      <!-- 动态加载 -->
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" id="close-details-modal">关闭</button>
      <a href="#" target="_blank" class="btn btn-primary" id="paper-download-btn">下载试卷</a>
    </div>
  </div>
</div>

<script>
// 应用状态管理
class FPaperApp {
  constructor() {
    this.state = {
      exams: [],
      categories: new Map(),
      currentPage: 'home',
      selectedPaperId: null,
      isLoading: true,
      currentTheme: 'light',
      currentColor: 'green',
      customColor: null,
      expandedExams: new Set(),
      animatingExams: new Set(), // 正在动画的联考
      navHistory: ['home']
    };
    
    this.colorThemes = {
      green: { primary: '#10b981', primaryDark: '#0d9668' },
      blue: { primary: '#3b82f6', primaryDark: '#2563eb' },
      purple: { primary: '#8b5cf6', primaryDark: '#7c3aed' },
      red: { primary: '#ef4444', primaryDark: '#dc2626' },
      orange: { primary: '#f59e0b', primaryDark: '#d97706' },
      teal: { primary: '#14b8a6', primaryDark: '#0d9488' },
      pink: { primary: '#ec4899', primaryDark: '#db2777' },
      indigo: { primary: '#6366f1', primaryDark: '#4f46e5' },
      cyan: { primary: '#06b6d4', primaryDark: '#0891b2' },
      lime: { primary: '#84cc16', primaryDark: '#65a30d' },
      amber: { primary: '#fbbf24', primaryDark: '#f59e0b' },
      rose: { primary: '#f43f5e', primaryDark: '#e11d48' },
      violet: { primary: '#a855f7', primaryDark: '#9333ea' },
      emerald: { primary: '#10b981', primaryDark: '#059669' },
      sky: { primary: '#0ea5e9', primaryDark: '#0284c7' },
      fuchsia: { primary: '#d946ef', primaryDark: '#c026d3' },
      yellow: { primary: '#eab308', primaryDark: '#ca8a04' },
      stone: { primary: '#78716c', primaryDark: '#57534e' },
      neutral: { primary: '#737373', primaryDark: '#525252' },
      zinc: { primary: '#71717a', primaryDark: '#52525b' }
    };
    
    this.toastCounter = 0;
    this.isColorTransitioning = false;
  }
  
  // 初始化应用
  async init() {
    this.loadThemeSettings();
    this.initEventListeners();
    await this.loadCategories();
    await this.loadExams();
    this.loadPlatformImage();
    this.showPage('home');
  }
  
  // 加载主题设置
  loadThemeSettings() {
    const savedTheme = localStorage.getItem('fpaper-theme');
    const savedColor = localStorage.getItem('fpaper-color');
    const savedCustomColor = localStorage.getItem('fpaper-custom-color');
    
    if (savedTheme) {
      this.state.currentTheme = savedTheme;
      document.documentElement.setAttribute('data-theme', savedTheme);
    }
    
    if (savedColor) {
      this.state.currentColor = savedColor;
    }
    
    if (savedCustomColor) {
      try {
        const colorData = JSON.parse(savedCustomColor);
        this.state.customColor = colorData;
        this.applyCustomColor(colorData, false);
      } catch (e) {
        console.warn('解析自定义颜色失败:', e);
      }
    } else if (savedColor) {
      this.applyColorTheme(savedColor, false);
    }
    
    this.updateThemeButtonIcon();
  }
  
  // 应用颜色主题
  applyColorTheme(colorName, showTransition = true, showToast = true) {
    const theme = this.colorThemes[colorName];
    if (!theme) return;
    
    this.applyColorValues(theme.primary, theme.primaryDark, showTransition);
    this.state.currentColor = colorName;
    this.state.customColor = null;
    
    localStorage.setItem('fpaper-color', colorName);
    localStorage.removeItem('fpaper-custom-color');
    
    if (showToast) {
      this.showToast(`已切换到${this.getColorName(colorName)}主题`, 'success');
    }
  }
  
  // 应用自定义颜色
  applyCustomColor(colorData, showTransition = true, showToast = true) {
    this.applyColorValues(colorData.primary, colorData.primaryDark, showTransition);
    this.state.customColor = colorData;
    
    localStorage.setItem('fpaper-custom-color', JSON.stringify(colorData));
    localStorage.removeItem('fpaper-color');
    
    if (showToast) {
      this.showToast('已应用自定义颜色', 'success');
    }
  }
  
  // 应用颜色值
  applyColorValues(primary, primaryDark, showTransition = true) {
    // 提取RGB值
    const primaryRGB = this.hexToRgb(primary);
    const primaryDarkRGB = this.hexToRgb(primaryDark);
    
    if (!primaryRGB || !primaryDarkRGB) return;
    
    // 显示颜色切换动效
    if (showTransition && !this.isColorTransitioning) {
      this.showColorTransition();
    }
    
    // 设置CSS变量
    const root = document.documentElement;
    root.style.setProperty('--primary', primary);
    root.style.setProperty('--primary-dark', primaryDark);
    root.style.setProperty('--primary-rgb', primaryRGB.join(', '));
    root.style.setProperty('--primary-dark-rgb', primaryDarkRGB.join(', '));
    root.style.setProperty('--gradient-primary', `linear-gradient(135deg, ${primary} 0%, ${primaryDark} 100%)`);
    
    // 更新所有提示框的颜色
    this.updateToastColors();
  }
  
  // 更新所有提示框的颜色
  updateToastColors() {
    document.querySelectorAll('.toast').forEach(toast => {
      // 移除旧的颜色类
      toast.classList.remove('toast-success', 'toast-error', 'toast-info', 'toast-warning');
      
      // 根据内容添加新的颜色类
      if (toast.querySelector('.fa-check-circle')) {
        toast.classList.add('toast-success');
        toast.style.borderLeftColor = 'var(--success)';
      } else if (toast.querySelector('.fa-exclamation-circle')) {
        toast.classList.add('toast-error');
        toast.style.borderLeftColor = 'var(--danger)';
      } else if (toast.querySelector('.fa-info-circle')) {
        toast.classList.add('toast-info');
        toast.style.borderLeftColor = 'var(--primary)';
      } else if (toast.querySelector('.fa-exclamation-triangle')) {
        toast.classList.add('toast-warning');
        toast.style.borderLeftColor = 'var(--warning)';
      } else {
        toast.classList.add('toast-info');
        toast.style.borderLeftColor = 'var(--primary)';
      }
    });
  }
  
  // 显示颜色切换动效
  showColorTransition() {
    this.isColorTransitioning = true;
    const transitionElement = document.querySelector('.color-transition');
    const pickerBtn = document.getElementById('color-picker-btn');
    
    if (!transitionElement || !pickerBtn) return;
    
    // 获取按钮位置
    const btnRect = pickerBtn.getBoundingClientRect();
    const centerX = btnRect.left + btnRect.width / 2;
    const centerY = btnRect.top + btnRect.height / 2;
    
    // 设置动画起始位置
    transitionElement.style.left = `${centerX}px`;
    transitionElement.style.top = `${centerY}px`;
    
    // 开始动画
    transitionElement.classList.remove('active');
    void transitionElement.offsetWidth; // 触发重排
    transitionElement.classList.add('active');
    
    // 动画结束后重置
    setTimeout(() => {
      transitionElement.classList.remove('active');
      this.isColorTransitioning = false;
    }, 800);
  }
  
  // 十六进制转RGB
  hexToRgb(hex) {
    const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
    return result ? [
      parseInt(result[1], 16),
      parseInt(result[2], 16),
      parseInt(result[3], 16)
    ] : null;
  }
  
  // RGB转十六进制
  rgbToHex(r, g, b) {
    return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
  }
  
  // 更新主题按钮图标
  updateThemeButtonIcon() {
    const themeToggleBtn = document.getElementById('theme-toggle-btn');
    const icon = themeToggleBtn.querySelector('i');
    
    if (this.state.currentTheme === 'light') {
      icon.className = 'fas fa-moon';
      themeToggleBtn.title = '切换到夜间模式';
    } else {
      icon.className = 'fas fa-sun';
      themeToggleBtn.title = '切换到日间模式';
    }
  }
  
  // 初始化事件监听器
  initEventListeners() {
    // 页面切换
    document.querySelectorAll('[data-page]').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const page = link.getAttribute('data-page');
        this.showPage(page);
      });
    });
    
    // 颜色选择器
    const colorPickerBtn = document.getElementById('color-picker-btn');
    const colorPickerMenu = document.getElementById('color-picker-menu');
    
    colorPickerBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      colorPickerMenu.classList.toggle('show');
      this.initColorPicker();
    });
    
    // 颜色标签切换
    document.querySelectorAll('.color-tab').forEach(tab => {
      tab.addEventListener('click', (e) => {
        document.querySelectorAll('.color-tab').forEach(t => t.classList.remove('active'));
        e.target.classList.add('active');
        
        const tabName = e.target.getAttribute('data-tab');
        document.querySelectorAll('.color-tab-content').forEach(content => {
          content.classList.add('d-none');
        });
        document.getElementById(tabName + '-colors').classList.remove('d-none');
      });
    });
    
    // 预设颜色选择
    document.querySelectorAll('.color-option').forEach(option => {
      option.addEventListener('click', (e) => {
        const color = e.target.getAttribute('data-color');
        document.querySelectorAll('.color-option').forEach(opt => {
          opt.classList.remove('active');
        });
        e.target.classList.add('active');
        
        // 更新预览
        const theme = this.colorThemes[color];
        if (theme) {
          document.getElementById('color-preview').style.background = 
            `linear-gradient(135deg, ${theme.primary} 0%, ${theme.primaryDark} 100%)`;
        }
      });
    });
    
    // RGB滑块
    ['r', 'g', 'b'].forEach(channel => {
      const slider = document.getElementById(`rgb-${channel}`);
      const valueSpan = document.getElementById(`rgb-${channel}-value`);
      
      slider.addEventListener('input', (e) => {
        valueSpan.textContent = e.target.value;
        this.updateCustomColorPreview();
      });
    });
    
    // 应用颜色
    document.getElementById('apply-color-btn').addEventListener('click', () => {
      const activeTab = document.querySelector('.color-tab.active').getAttribute('data-tab');
      
      if (activeTab === 'preset') {
        const selectedColor = document.querySelector('.color-option.active').getAttribute('data-color');
        this.applyColorTheme(selectedColor, true, true);
      } else {
        const r = parseInt(document.getElementById('rgb-r').value);
        const g = parseInt(document.getElementById('rgb-g').value);
        const b = parseInt(document.getElementById('rgb-b').value);
        
        const primary = this.rgbToHex(r, g, b);
        const primaryDark = this.rgbToHex(
          Math.max(0, Math.floor(r * 0.8)),
          Math.max(0, Math.floor(g * 0.8)),
          Math.max(0, Math.floor(b * 0.8))
        );
        
        this.applyCustomColor({ primary, primaryDark }, true, true);
      }
      
      colorPickerMenu.classList.remove('show');
    });
    
    // 重置颜色
    document.getElementById('reset-color-btn').addEventListener('click', () => {
      this.applyColorTheme('green', true, true);
      colorPickerMenu.classList.remove('show');
    });
    
    // 主题切换
    document.getElementById('theme-toggle-btn').addEventListener('click', () => {
      this.toggleTheme();
    });
    
    // 关闭颜色选择器
    document.addEventListener('click', (e) => {
      if (!colorPickerBtn.contains(e.target) && !colorPickerMenu.contains(e.target)) {
        colorPickerMenu.classList.remove('show');
      }
    });
    
    // 搜索功能
    document.getElementById('search-papers-btn').addEventListener('click', () => {
      this.searchPapers();
    });
    
    document.getElementById('reset-search-btn').addEventListener('click', () => {
      this.resetSearch();
    });
    
    // 模态框
    document.getElementById('close-download-modal').addEventListener('click', () => {
      this.hideModal('download-modal');
    });
    
    document.getElementById('cancel-download').addEventListener('click', () => {
      this.hideModal('download-modal');
    });
    
    document.getElementById('close-paper-details').addEventListener('click', () => {
      this.hideModal('paper-details-modal');
    });
    
    document.getElementById('close-details-modal').addEventListener('click', () => {
      this.hideModal('paper-details-modal');
    });
    
    // 滚动效果
    window.addEventListener('scroll', () => {
      const navbar = document.querySelector('.navbar');
      if (window.scrollY > 50) {
        navbar.classList.add('scrolled');
      } else {
        navbar.classList.remove('scrolled');
      }
    });
    
    // 点击模态框外部关闭
    document.addEventListener('click', (e) => {
      if (e.target.classList.contains('modal')) {
        this.hideModal(e.target.id);
      }
    });
  }
  
  // 初始化颜色选择器
  initColorPicker() {
    // 更新预设颜色选中状态
    document.querySelectorAll('.color-option').forEach(option => {
      option.classList.remove('active');
      if (option.getAttribute('data-color') === this.state.currentColor) {
        option.classList.add('active');
      }
    });
    
    // 更新自定义颜色滑块
    if (this.state.customColor) {
      const rgb = this.hexToRgb(this.state.customColor.primary);
      if (rgb) {
        document.getElementById('rgb-r').value = rgb[0];
        document.getElementById('rgb-g').value = rgb[1];
        document.getElementById('rgb-b').value = rgb[2];
        document.getElementById('rgb-r-value').textContent = rgb[0];
        document.getElementById('rgb-g-value').textContent = rgb[1];
        document.getElementById('rgb-b-value').textContent = rgb[2];
      }
    } else {
      // 使用当前主题颜色
      const theme = this.colorThemes[this.state.currentColor];
      if (theme) {
        const rgb = this.hexToRgb(theme.primary);
        if (rgb) {
          document.getElementById('rgb-r').value = rgb[0];
          document.getElementById('rgb-g').value = rgb[1];
          document.getElementById('rgb-b').value = rgb[2];
          document.getElementById('rgb-r-value').textContent = rgb[0];
          document.getElementById('rgb-g-value').textContent = rgb[1];
          document.getElementById('rgb-b-value').textContent = rgb[2];
        }
      }
    }
    
    this.updateCustomColorPreview();
  }
  
  // 更新自定义颜色预览
  updateCustomColorPreview() {
    const r = parseInt(document.getElementById('rgb-r').value);
    const g = parseInt(document.getElementById('rgb-g').value);
    const b = parseInt(document.getElementById('rgb-b').value);
    
    const primary = this.rgbToHex(r, g, b);
    const primaryDark = this.rgbToHex(
      Math.max(0, Math.floor(r * 0.8)),
      Math.max(0, Math.floor(g * 0.8)),
      Math.max(0, Math.floor(b * 0.8))
    );
    
    document.getElementById('color-preview').style.background = 
      `linear-gradient(135deg, ${primary} 0%, ${primaryDark} 100%)`;
  }
  
  // 切换主题
  toggleTheme() {
    const newTheme = this.state.currentTheme === 'light' ? 'dark' : 'light';
    this.state.currentTheme = newTheme;
    
    document.documentElement.setAttribute('data-theme', newTheme);
    localStorage.setItem('fpaper-theme', newTheme);
    
    // 重新应用颜色
    if (this.state.customColor) {
      this.applyCustomColor(this.state.customColor, true, false);
    } else {
      this.applyColorTheme(this.state.currentColor, true, false);
    }
    
    this.updateThemeButtonIcon();
    this.showToast(`已切换到${newTheme === 'light' ? '日间' : '夜间'}模式`, 'success');
  }
  
  // 获取颜色名称
  getColorName(color) {
    const names = {
      green: '清新绿', blue: '天空蓝', purple: '优雅紫', red: '热情红',
      orange: '活力橙', teal: '宁静青', pink: '浪漫粉', indigo: '深邃靛',
      cyan: '科技青', lime: '活力绿', amber: '琥珀黄', rose: '玫瑰红',
      violet: '紫罗兰', emerald: '翡翠绿', sky: '天空蓝', fuchsia: '洋红色',
      yellow: '阳光黄', stone: '岩石灰', neutral: '中性灰', zinc: '锌灰色'
    };
    return names[color] || color;
  }
  
  // 显示提示 - 优化颜色适配
  showToast(message, type = 'info', useCustomColor = false) {
    this.toastCounter++;
    const toastId = `toast-${this.toastCounter}`;
    
    const toast = document.createElement('div');
    toast.id = toastId;
    toast.className = `toast toast-${type}`;
    
    const iconClass = {
      success: 'fa-check-circle',
      error: 'fa-exclamation-circle',
      info: 'fa-info-circle',
      warning: 'fa-exclamation-triangle'
    }[type] || 'fa-info-circle';
    
    // 设置边框颜色
    let borderColor = 'var(--primary)';
    if (type === 'success') borderColor = 'var(--success)';
    if (type === 'error') borderColor = 'var(--danger)';
    if (type === 'warning') borderColor = 'var(--warning)';
    
    // 如果是颜色切换通知，使用当前颜色
    if (useCustomColor && type === 'info' && (message.includes('切换') || message.includes('应用'))) {
      borderColor = 'var(--primary)';
    }
    
    toast.innerHTML = `
      <div class="toast-content">
        <i class="fas ${iconClass} toast-icon"></i>
        <div class="toast-message">${message}</div>
        <button class="toast-close" onclick="app.removeToast('${toastId}')">
          <i class="fas fa-times"></i>
        </button>
      </div>
    `;
    
    // 设置动态边框颜色
    toast.style.borderLeftColor = borderColor;
    
    document.querySelector('.toast-container').appendChild(toast);
    
    setTimeout(() => {
      this.removeToast(toastId);
    }, 4000);
  }
  
  // 移除提示
  removeToast(toastId) {
    const toast = document.getElementById(toastId);
    if (!toast) return;
    
    toast.classList.add('fade-out');
    setTimeout(() => toast.remove(), 300);
  }
  
  // 显示页面
  showPage(pageName) {
    const currentPage = this.state.currentPage;
    const pages = ['home', 'papers', 'about'];
    const currentIndex = pages.indexOf(currentPage);
    const targetIndex = pages.indexOf(pageName);
    
    // 更新导航历史
    this.state.navHistory.push(pageName);
    if (this.state.navHistory.length > 5) this.state.navHistory.shift();
    
    // 隐藏所有页面
    document.querySelectorAll('.page').forEach(page => {
      page.classList.remove('active');
    });
    
    // 更新导航链接
    document.querySelectorAll('.nav-link').forEach(link => {
      link.classList.remove('active', 'slide-left', 'slide-right');
      
      if (link.getAttribute('data-page') === pageName) {
        link.classList.add('active');
        
        // 添加导航动效
        if (targetIndex > currentIndex) {
          link.classList.add('slide-right');
        } else if (targetIndex < currentIndex) {
          link.classList.add('slide-left');
        }
      }
    });
    
    // 显示目标页面
    const targetPage = document.getElementById(`${pageName}-page`);
    if (targetPage) {
      targetPage.classList.add('active');
      this.state.currentPage = pageName;
      
      // 加载页面数据
      switch (pageName) {
        case 'home':
          this.renderRecentExams();
          this.updateStats();
          break;
        case 'papers':
          this.renderExamsTable();
          break;
      }
    }
  }
  
  // 加载科目分类
  async loadCategories() {
    try {
      const response = await fetch('category.txt', { cache: 'no-cache' });
      if (!response.ok) throw new Error(`HTTP ${response.status}`);
      
      const text = await response.text();
      if (!text.trim()) throw new Error('文件为空');
      
      const categories = new Map();
      const lines = text.trim().split('\n');
      
      lines.forEach(line => {
        const trimmed = line.trim();
        if (!trimmed) return;
        
        const dotIndex = trimmed.indexOf('.');
        if (dotIndex === -1) return;
        
        const id = trimmed.substring(0, dotIndex).trim();
        const name = trimmed.substring(dotIndex + 1).trim();
        
        if (id && name) {
          categories.set(id, name);
        }
      });
      
      this.state.categories = categories;
      console.log(`加载了 ${categories.size} 个科目分类`);
      
    } catch (error) {
      console.error('加载科目分类失败:', error);
      this.showToast('加载科目分类失败，使用默认分类', 'warning');
      this.loadDefaultCategories();
    }
  }
  
  // 加载默认分类
  loadDefaultCategories() {
    const defaultCategories = new Map([
      ['1', '语文'], ['2', '数学'], ['3', '英语'], ['4', '物理'],
      ['5', '化学'], ['6', '技术'], ['7', '生物'], ['8', '地理'],
      ['9', '历史'], ['10', '政治']
    ]);
    
    this.state.categories = defaultCategories;
  }
  
  // 加载联考数据
  async loadExams() {
    try {
      this.state.isLoading = true;
      
      const response = await fetch('data.txt', { cache: 'no-cache' });
      if (!response.ok) throw new Error(`HTTP ${response.status}`);
      
      const text = await response.text();
      if (!text.trim()) throw new Error('文件为空');
      
      const exams = this.parseExamData(text);
      this.state.exams = exams;
      
      console.log(`加载了 ${exams.length} 个联考`);
      
      // 初始化筛选器
      this.initFilters();
      
    } catch (error) {
      console.error('加载联考数据失败:', error);
      this.showToast('加载联考数据失败', 'error');
    } finally {
      this.state.isLoading = false;
      this.updateDataSourceInfo();
      this.updateFooterCategories();
    }
  }
  
  // 解析联考数据
  parseExamData(text) {
    const exams = [];
    const lines = text.trim().split('\n');
    let examId = 1;
    let paperId = 1;
    
    lines.forEach((line, index) => {
      try {
        const trimmed = line.trim();
        if (!trimmed) return;
        
        // 解析格式：联考名称 [[试卷1,日期1,链接1,分类1],[试卷2,日期2,链接2,分类2]]
        const bracketStart = trimmed.indexOf('[[');
        const bracketEnd = trimmed.lastIndexOf(']]');
        
        if (bracketStart === -1 || bracketEnd === -1) return;
        
        const examName = trimmed.substring(0, bracketStart).trim();
        const papersData = trimmed.substring(bracketStart + 2, bracketEnd);
        
        // 解析试卷列表
        const papers = [];
        const paperMatches = papersData.split('],[');
        
        paperMatches.forEach(paperStr => {
          const cleanStr = paperStr.replace(/[\[\]]/g, '');
          const parts = cleanStr.split(',');
          
          if (parts.length >= 4) {
            const paperName = parts[0].trim();
            const dateStr = parts[1].trim();
            const url = parts[2].trim();
            const categoryId = parts[3].trim();
            
            const dateMatch = dateStr.match(/(\d{4})\.(\d{1,2})\.(\d{1,2})/);
            if (dateMatch) {
              const year = parseInt(dateMatch[1]);
              const month = parseInt(dateMatch[2]);
              const day = parseInt(dateMatch[3]);
              
              const categoryName = this.state.categories.get(categoryId) || '其他';
              const formattedDate = `${year}年${month}月${day}日`;
              
              papers.push({
                id: paperId++,
                name: paperName,
                year: year,
                month: month,
                day: day,
                date: formattedDate,
                fullDate: dateStr,
                categoryId: categoryId,
                category: categoryName,
                url: url.startsWith('http') ? url : `https://${url}`,
                description: `${paperName}，发布于${formattedDate}。这是一份${categoryName}试卷。`
              });
            }
          }
        });
        
        if (papers.length > 0) {
          // 计算联考信息
          const latestPaper = papers.reduce((latest, paper) => {
            if (!latest) return paper;
            const latestDate = new Date(latest.year, latest.month - 1, latest.day);
            const currentDate = new Date(paper.year, paper.month - 1, paper.day);
            return currentDate > latestDate ? paper : latest;
          }, null);
          
          const subjects = [...new Set(papers.map(p => p.category))];
          
          exams.push({
            id: examId++,
            name: examName,
            papers: papers,
            latestDate: latestPaper ? latestPaper.fullDate : '',
            formattedDate: latestPaper ? latestPaper.date : '',
            year: latestPaper ? latestPaper.year : new Date().getFullYear(),
            subjects: subjects,
            subjectCount: papers.length,
            description: `${examName}共包含${papers.length}个科目的试卷。`
          });
        }
        
      } catch (error) {
        console.warn(`解析第 ${index + 1} 行失败:`, error);
      }
    });
    
    return exams;
  }
  
  // 加载平台图片
  async loadPlatformImage() {
    const img = document.getElementById('platform-image');
    const errorDiv = document.getElementById('image-error');
    
    img.onload = () => {
      errorDiv.classList.add('d-none');
      img.style.display = 'block';
    };
    
    img.onerror = () => {
      img.style.display = 'none';
      errorDiv.classList.remove('d-none');
    };
    
    // 尝试加载图片
    img.src = 'image.png';
  }
  
  // 初始化筛选器
  initFilters() {
    const categoryFilter = document.getElementById('paper-category');
    const yearFilter = document.getElementById('paper-year');
    
    // 清空现有选项
    categoryFilter.innerHTML = '<option value="">所有科目</option>';
    yearFilter.innerHTML = '<option value="">所有年份</option>';
    
    // 添加科目选项
    const categories = Array.from(this.state.categories.values()).sort();
    categories.forEach(category => {
      const option = document.createElement('option');
      option.value = category;
      option.textContent = category;
      categoryFilter.appendChild(option);
    });
    
    // 添加年份选项
    const years = new Set();
    this.state.exams.forEach(exam => {
      years.add(exam.year);
    });
    
    Array.from(years).sort((a, b) => b - a).forEach(year => {
      const option = document.createElement('option');
      option.value = year;
      option.textContent = year;
      yearFilter.appendChild(option);
    });
  }
  
  // 更新数据源信息
  updateDataSourceInfo() {
    const infoElement = document.getElementById('data-source-info');
    const examsCountElement = document.getElementById('loaded-exams-count');
    const papersCountElement = document.getElementById('loaded-papers-count');
    
    if (infoElement && examsCountElement && papersCountElement) {
      const totalPapers = this.state.exams.reduce((sum, exam) => sum + exam.papers.length, 0);
      
      examsCountElement.textContent = this.state.exams.length;
      papersCountElement.textContent = totalPapers;
      
      infoElement.innerHTML = `
        <i class="fas fa-database"></i>
        <span>数据源：data.txt + category.txt文件 | 共加载了${this.state.exams.length}个联考，${totalPapers}份试卷</span>
      `;
      infoElement.classList.remove('d-none');
    }
  }
  
  // 更新页脚分类
  updateFooterCategories() {
    const container = document.getElementById('footer-categories');
    if (!container) return;
    
    container.innerHTML = '';
    
    const categories = Array.from(this.state.categories.values()).sort();
    categories.slice(0, 6).forEach(category => {
      const li = document.createElement('li');
      li.innerHTML = `<a href="#" class="footer-link" data-category="${category}">${category}</a>`;
      container.appendChild(li);
    });
    
    // 绑定点击事件
    container.querySelectorAll('.footer-link[data-category]').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const category = link.getAttribute('data-category');
        this.showPage('papers');
        document.getElementById('paper-category').value = category;
        this.searchPapers();
      });
    });
  }
  
  // 更新统计信息
  updateStats() {
    if (this.state.exams.length === 0) return;
    
    const totalPapers = this.state.exams.reduce((sum, exam) => sum + exam.papers.length, 0);
    
    const years = new Set();
    this.state.exams.forEach(exam => {
      exam.papers.forEach(paper => {
        years.add(paper.year);
      });
    });
    
    const yearArray = Array.from(years);
    const yearSpan = yearArray.length > 0 ? 
      `${Math.min(...yearArray)}-${Math.max(...yearArray)}` : '0';
    
    document.getElementById('total-papers').textContent = totalPapers;
    document.getElementById('total-years').textContent = yearSpan;
    document.getElementById('total-categories').textContent = this.state.categories.size;
    document.getElementById('latest-year').textContent = Math.max(...yearArray) || '2025';
  }
  
  // 渲染最新联考
  renderRecentExams() {
    const container = document.getElementById('recent-papers-table');
    if (!container) return;
    
    if (this.state.exams.length === 0) {
      container.innerHTML = `
        <div class="empty-state">
          <div class="empty-state-icon">
            <i class="fas fa-book-open"></i>
          </div>
          <h3 class="empty-state-title">暂无联考数据</h3>
          <p class="empty-state-description">请确保data.txt和category.txt文件存在且格式正确。</p>
        </div>
      `;
      return;
    }
    
    const recentExams = [...this.state.exams]
      .sort((a, b) => b.year - a.year)
      .slice(0, 5);
    
    let html = `
      <table class="papers-table">
        <thead>
          <tr>
            <th>联考名称</th>
            <th>包含科目</th>
            <th>最新日期</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>
    `;
    
    recentExams.forEach(exam => {
      const isExpanded = this.state.expandedExams.has(exam.id);
      const isAnimating = this.state.animatingExams.has(exam.id);
      
      html += `
        <tr class="exam-row" data-exam-id="${exam.id}">
          <td>
            <div style="font-weight: 600;">${exam.name}</div>
            <div style="font-size: 14px; color: var(--gray-600); margin-top: 4px;">
              共${exam.subjectCount}个科目
            </div>
          </td>
          <td>${exam.subjects.join('、')}</td>
          <td>${exam.formattedDate}</td>
          <td>
            <div class="action-buttons">
              <button class="btn btn-sm btn-primary toggle-exam-btn" data-exam-id="${exam.id}">
                <i class="fas fa-chevron-${isExpanded ? 'up' : 'down'}"></i>
                ${isExpanded ? '收起' : '展开'}
              </button>
            </div>
          </td>
        </tr>
      `;
      
      if (isExpanded) {
        html += `
          <tr class="exam-details ${isAnimating ? 'expanding' : ''}" data-exam-id="${exam.id}">
            <td colspan="4">
              <div class="exam-details-content ${isAnimating ? 'animating' : ''}">
                <h4 style="margin-bottom: 15px;">${exam.name} 包含试卷</h4>
                <div style="display: grid; gap: 10px;">
        `;
        
        exam.papers.forEach((paper, index) => {
          html += `
            <div class="exam-subject ${isAnimating ? 'animating' : ''}" style="${isAnimating ? `animation-delay: ${0.1 + index * 0.05}s` : ''}">
              <div>
                <div class="exam-subject-name">${paper.name}</div>
                <div class="exam-subject-date">${paper.date} | ${paper.category}</div>
              </div>
              <div class="action-buttons">
                <button class="btn btn-sm btn-primary download-btn" data-id="${paper.id}">
                  <i class="fas fa-download"></i>
                  下载
                </button>
                <button class="btn btn-sm btn-outline view-btn" data-id="${paper.id}">
                  <i class="fas fa-eye"></i>
                  查看
                </button>
              </div>
            </div>
          `;
        });
        
        html += `
                </div>
              </div>
            </td>
          </tr>
        `;
      }
    });
    
    html += `
        </tbody>
      </table>
    `;
    
    container.innerHTML = html;
    this.bindPaperEvents();
  }
  
  // 渲染联考表格
  renderExamsTable(searchTerm = '', category = '', year = '') {
    const container = document.getElementById('papers-table-body');
    if (!container) return;
    
    let filteredData;
    
    // 如果有科目筛选，显示试卷列表
    if (category) {
      // 收集所有符合条件的试卷
      const allPapers = [];
      this.state.exams.forEach(exam => {
        exam.papers.forEach(paper => {
          if (paper.category === category) {
            allPapers.push({ ...paper, examName: exam.name });
          }
        });
      });
      
      // 应用其他筛选
      filteredData = allPapers.filter(item => {
        const matchesSearch = !searchTerm || 
          item.name.toLowerCase().includes(searchTerm) ||
          item.examName.toLowerCase().includes(searchTerm);
        const matchesYear = !year || item.year.toString() === year;
        return matchesSearch && matchesYear;
      });
      
      // 按日期排序
      filteredData.sort((a, b) => {
        if (b.year !== a.year) return b.year - a.year;
        if (b.month !== a.month) return b.month - a.month;
        return b.day - a.day;
      });
      
    } else {
      // 没有科目筛选，显示联考列表
      filteredData = this.state.exams.filter(exam => {
        const matchesSearch = !searchTerm || 
          exam.name.toLowerCase().includes(searchTerm) ||
          exam.subjects.some(subject => subject.toLowerCase().includes(searchTerm));
        const matchesYear = !year || exam.year.toString() === year;
        return matchesSearch && matchesYear;
      });
      
      // 按年份排序
      filteredData.sort((a, b) => b.year - a.year);
    }
    
    // 渲染结果
    if (filteredData.length === 0) {
      container.innerHTML = `
        <tr>
          <td colspan="4" style="text-align: center; padding: 40px;">
            <div class="empty-state">
              <i class="fas fa-search empty-state-icon"></i>
              <h3 class="empty-state-title">没有找到数据</h3>
              <p class="empty-state-description">尝试调整筛选条件</p>
            </div>
          </td>
        </tr>
      `;
      return;
    }
    
    let html = '';
    
    if (category) {
      // 渲染试卷列表
      filteredData.forEach(paper => {
        html += `
          <tr>
            <td>
              <div style="font-weight: 600;">${paper.name}</div>
              <div style="font-size: 14px; color: var(--gray-600); margin-top: 4px;">
                所属联考：${paper.examName}
              </div>
            </td>
            <td>${paper.category}</td>
            <td>${paper.date}</td>
            <td>
              <div class="action-buttons">
                <button class="btn btn-sm btn-primary download-btn" data-id="${paper.id}">
                  <i class="fas fa-download"></i>
                  下载
                </button>
                <button class="btn btn-sm btn-outline view-btn" data-id="${paper.id}">
                  <i class="fas fa-eye"></i>
                  查看
                </button>
              </div>
            </td>
          </tr>
        `;
      });
    } else {
      // 渲染联考列表
      filteredData.forEach((exam, examIndex) => {
        const isExpanded = this.state.expandedExams.has(exam.id);
        const isAnimating = this.state.animatingExams.has(exam.id);
        
        html += `
          <tr class="exam-row" data-exam-id="${exam.id}">
            <td>
              <div style="font-weight: 600;">${exam.name}</div>
              <div style="font-size: 14px; color: var(--gray-600); margin-top: 4px;">
                共${exam.subjectCount}个科目
              </div>
            </td>
            <td>${exam.subjects.join('、')}</td>
            <td>${exam.formattedDate}</td>
            <td>
              <div class="action-buttons">
                <button class="btn btn-sm btn-primary toggle-exam-btn" data-exam-id="${exam.id}">
                  <i class="fas fa-chevron-${isExpanded ? 'up' : 'down'}"></i>
                  ${isExpanded ? '收起' : '展开'}
                </button>
              </div>
            </td>
          </tr>
        `;
        
        if (isExpanded) {
          html += `
            <tr class="exam-details ${isAnimating ? 'expanding' : ''}" data-exam-id="${exam.id}">
              <td colspan="4">
                <div class="exam-details-content ${isAnimating ? 'animating' : ''}">
                  <h4 style="margin-bottom: 15px;">${exam.name} 包含试卷</h4>
                  <div style="display: grid; gap: 10px;">
          `;
          
          exam.papers.forEach((paper, paperIndex) => {
            html += `
              <div class="exam-subject ${isAnimating ? 'animating' : ''}" style="${isAnimating ? `animation-delay: ${0.1 + paperIndex * 0.05}s` : ''}">
                <div>
                  <div class="exam-subject-name">${paper.name}</div>
                  <div class="exam-subject-date">${paper.date} | ${paper.category}</div>
                </div>
                <div class="action-buttons">
                  <button class="btn btn-sm btn-primary download-btn" data-id="${paper.id}">
                    <i class="fas fa-download"></i>
                    下载
                  </button>
                  <button class="btn btn-sm btn-outline view-btn" data-id="${paper.id}">
                    <i class="fas fa-eye"></i>
                    查看
                  </button>
                </div>
              </div>
            `;
          });
          
          html += `
                  </div>
                </div>
              </td>
            </tr>
          `;
        }
      });
    }
    
    container.innerHTML = html;
    this.bindPaperEvents();
  }
  
  // 绑定试卷事件
  bindPaperEvents() {
    // 展开/收起联考
    document.querySelectorAll('.toggle-exam-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        const examId = parseInt(btn.getAttribute('data-exam-id'));
        this.toggleExamExpansion(examId);
      });
    });
    
    // 点击联考行
    document.querySelectorAll('.exam-row').forEach(row => {
      row.addEventListener('click', (e) => {
        if (!e.target.closest('.action-buttons')) {
          const examId = parseInt(row.getAttribute('data-exam-id'));
          this.toggleExamExpansion(examId);
        }
      });
    });
    
    // 下载按钮
    document.querySelectorAll('.download-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        const paperId = parseInt(btn.getAttribute('data-id'));
        this.showDownloadModal(paperId);
      });
    });
    
    // 查看按钮
    document.querySelectorAll('.view-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        const paperId = parseInt(btn.getAttribute('data-id'));
        this.showPaperDetails(paperId);
      });
    });
  }
  
  // 切换联考展开状态
  toggleExamExpansion(examId) {
    const isExpanding = !this.state.expandedExams.has(examId);
    
    if (isExpanding) {
      // 添加动画状态
      this.state.animatingExams.add(examId);
      this.state.expandedExams.add(examId);
    } else {
      // 收起，移除状态
      this.state.expandedExams.delete(examId);
    }
    
    // 重新渲染当前页面
    if (this.state.currentPage === 'home') {
      this.renderRecentExams();
    } else {
      this.renderExamsTable(
        document.getElementById('paper-search').value,
        document.getElementById('paper-category').value,
        document.getElementById('paper-year').value
      );
    }
    
    // 如果正在展开，动画结束后移除动画状态
    if (isExpanding) {
      setTimeout(() => {
        this.state.animatingExams.delete(examId);
        
        // 重新渲染以移除动画类
        if (this.state.currentPage === 'home') {
          this.renderRecentExams();
        } else {
          this.renderExamsTable(
            document.getElementById('paper-search').value,
            document.getElementById('paper-category').value,
            document.getElementById('paper-year').value
          );
        }
      }, 500); // 动画持续时间 + 缓冲
    }
  }
  
  // 搜索试卷
  searchPapers() {
    const searchTerm = document.getElementById('paper-search').value.toLowerCase();
    const category = document.getElementById('paper-category').value;
    const year = document.getElementById('paper-year').value;
    
    this.state.animatingExams.clear(); // 清除所有动画状态
    this.renderExamsTable(searchTerm, category, year);
  }
  
  // 重置搜索
  resetSearch() {
    document.getElementById('paper-search').value = '';
    document.getElementById('paper-category').value = '';
    document.getElementById('paper-year').value = '';
    this.state.expandedExams.clear();
    this.state.animatingExams.clear();
    this.renderExamsTable();
  }
  
  // 显示下载模态框
  showDownloadModal(paperId) {
    let targetPaper = null;
    let examName = '';
    
    // 查找试卷
    for (const exam of this.state.exams) {
      const paper = exam.papers.find(p => p.id === paperId);
      if (paper) {
        targetPaper = paper;
        examName = exam.name;
        break;
      }
    }
    
    if (!targetPaper) return;
    
    document.getElementById('download-paper-name').textContent = targetPaper.name;
    document.getElementById('download-paper-url').textContent = targetPaper.url;
    
    const downloadLink = document.getElementById('confirm-download-link');
    downloadLink.href = targetPaper.url;
    downloadLink.target = '_blank';
    
    this.state.selectedPaperId = paperId;
    this.showModal('download-modal');
  }
  
  // 显示试卷详情
  showPaperDetails(paperId) {
    let targetPaper = null;
    let examName = '';
    
    for (const exam of this.state.exams) {
      const paper = exam.papers.find(p => p.id === paperId);
      if (paper) {
        targetPaper = paper;
        examName = exam.name;
        break;
      }
    }
    
    if (!targetPaper) return;
    
    document.getElementById('paper-details-title').textContent = targetPaper.name;
    
    const content = `
      <div style="margin-bottom: 20px;">
        <span style="background: rgba(var(--primary-rgb), 0.1); color: var(--primary); padding: 4px 12px; border-radius: var(--radius-md); font-size: 14px; font-weight: 600;">
          ${targetPaper.category}
        </span>
        <span style="margin-left: 10px; color: var(--gray-600);">
          <i class="fas fa-calendar-alt"></i> ${targetPaper.year}年
        </span>
      </div>
      <p style="margin-bottom: 10px; color: var(--gray-700);">
        <strong>所属联考：</strong>${examName}
      </p>
      <p style="margin-bottom: 10px; color: var(--gray-700);">
        <strong>发布日期：</strong>${targetPaper.date}
      </p>
      <p style="margin-bottom: 20px; color: var(--gray-700); line-height: 1.6;">
        ${targetPaper.description}
      </p>
      <div style="background: rgba(var(--primary-rgb), 0.1); color: var(--primary); padding: 12px; border-radius: var(--radius-md); border-left: 4px solid var(--primary);">
        <i class="fas fa-link"></i>
        <span>试卷链接：<a href="${targetPaper.url}" target="_blank" style="color: var(--primary);">${targetPaper.url}</a></span>
      </div>
    `;
    
    document.getElementById('paper-details-content').innerHTML = content;
    document.getElementById('paper-download-btn').href = targetPaper.url;
    this.showModal('paper-details-modal');
  }
  
  // 显示模态框
  showModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
      modal.classList.add('show');
      document.body.style.overflow = 'hidden';
    }
  }
  
  // 隐藏模态框
  hideModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
      modal.classList.remove('show');
      document.body.style.overflow = 'auto';
    }
  }
}

// 创建应用实例
const app = new FPaperApp();

// 页面加载完成后初始化
document.addEventListener('DOMContentLoaded', () => {
  app.init();
});
</script>
</body>
</html>
